<!DOCTYPE html>
<html>
<head>
  <title>Xenia Web Services</title>
  <link rel="shortcut icon" type="image/png" href="https://raw.githubusercontent.com/xenia-canary/xenia-canary/canary_experimental/assets/icon/1024.png">
  <link rel="apple-touch-icon" type="image/png" href="https://raw.githubusercontent.com/xenia-canary/xenia-canary/canary_experimental/assets/icon/1024.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Server Status">

  <!-- OG Meta Tags -->
  <meta property="og:url" content="https://xenia-netplay-2a0298c0e3f4.herokuapp.com/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Xenia Web Services">
  <meta property="og:description" content="Server Status">
  <meta property="og:image" content="https://raw.githubusercontent.com/xenia-canary/xenia-canary/canary_experimental/assets/icon/1024.png">

  <style>
      body {
          background-color: #181a1b;
          color: #e8e6e3;
      }

      a {
          color: #1d5ceb;
      }

      .sessions {
          width: 200px;
          height: 200px;
          border: 2px solid black;
          margin: 10px;
      }

      table {
          table-layout: fixed;
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 80%;
      }

      @media only screen and (max-width: 600px) {
        table {
            table-layout: auto;
        }
      }

      td,
      th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
      }

      tr:nth-child(even) {
          background-color: #2b2f31;
      }
  </style>
</head>
<body>
  <center>
      <h1>Xenia Web Services</h1>
      <a href="https://github.com/AdrianCassar/xenia-canary/tree/netplay_canary_experimental" target="_blank">Github</a>
      <a href="https://github.com/AdrianCassar/xenia-canary/releases" target="_blank">Releases</a>

      <br />
      <br />

      <div id="sessions"></div>

      <br />
      <br />

      <div id="countdown"></div>

      <!-- <label>Players Online: {online}</label> -->
  </center>

  <script>
      function generateSessionsTable(gamesData) {
          let result = '';

          result += "<table>\n";

          result += `<tr>\n`;
          result += `<th>Title</th>\n`;
          result += `<th>Players</th>\n`;
          result += `</tr>\n`;

          for (const game in gamesData) {
              const playersData = gamesData[game];

              for (const playerInfo of playersData) {
                  result += `<tr>\n`;
                  result += `<td>${game}</td>\n`;
                  result += `<td>${playerInfo.players}</td>\n`;
                  result += `</tr>\n`;
              }
          }

          result += "</table>\n";

          return result;
      }

      function HttpGet(url) {
          var xmlHttp = new XMLHttpRequest();

          xmlHttp.open("GET", url, false); // Synchronous Request
          xmlHttp.send();

          return xmlHttp;
      }

      function refreshSessionTable() {
          let sessionData = {};

          const response = HttpGet(window.origin + "/sessions");

          if (response.status == 304 || response.status == 200) {
            sessionData = JSON.parse(response.responseText);
          }

          document.getElementById("sessions").innerHTML = generateSessionsTable(sessionData);
      }

      var time = 60;

      function refreshTimer() {
          if (time <= 0) {
            refreshSessionTable();
              time = 60;
          }

          document.getElementById("countdown").innerHTML = "Refreshing in " + time + "s";

          time -= 1;
      }

      function setIntervalImmediately(func, interval) {
        func();
        return setInterval(func, interval);
      }

      setIntervalImmediately(refreshTimer, 1000);
      
      refreshSessionTable();
  </script>
</body>
</html>